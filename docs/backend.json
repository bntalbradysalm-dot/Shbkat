{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Shabakat Wallet application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.",
          "format": "uuid"
        },
        "phoneNumber": {
          "type": "string",
          "description": "The user's phone number.",
          "format": "string"
        },
        "firstName": {
          "type": "string",
          "description": "The user's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The user's last name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "registrationDate": {
          "type": "string",
          "description": "The date and time the user registered.",
          "format": "date-time"
        },
        "alWadiAccountId": {
          "type": "string",
          "description": "Identifier for the user's Al-Wadi account."
        },
        "lastNotificationRead": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of the last notification read by the user."
        }
      },
      "required": [
        "id",
        "phoneNumber",
        "firstName",
        "lastName",
        "registrationDate"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a transaction made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who initiated the transaction. (Relationship: User 1:N Transaction)"
        },
        "transactionDate": {
          "type": "string",
          "description": "The date and time the transaction occurred.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction."
        },
        "transactionType": {
          "type": "string",
          "description": "The type of transaction (e.g., deposit, withdrawal, transfer)."
        },
        "recipientPhoneNumber": {
          "type": "string",
          "description": "The phone number of the recipient (if applicable)."
        },
        "notes": {
          "type": "string",
          "description": "Additional notes or details about the transaction."
        }
      },
      "required": [
        "id",
        "userId",
        "transactionDate",
        "amount",
        "transactionType"
      ]
    },
    "Favorite": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Favorite",
      "type": "object",
      "description": "Represents a user's favorite item, such as a network or a contact.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the favorite."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who created the favorite."
        },
        "targetId": {
          "type": "string",
          "description": "The ID of the favorited item (e.g., network ID, contact ID)."
        },
        "name": {
          "type": "string",
          "description": "A user-defined name or the name of the item."
        },
        "location": {
          "type": "string",
          "description": "Location of the network, if the favorite is a network."
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number, if the favorite is a contact or network."
        },
        "favoriteType": {
          "type": "string",
          "enum": ["Network", "Contact"],
          "description": "Type of favorite (e.g., Network, Contact)."
        }
      },
      "required": [
        "id",
        "userId",
        "targetId",
        "name",
        "favoriteType"
      ]
    },
    "AlwadiRenewalOption": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AlwadiRenewalOption",
      "type": "object",
      "description": "Represents a renewal option for the Al-Wadi service.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the renewal option."
        },
        "title": {
          "type": "string",
          "description": "The display title for the renewal option (e.g., 'تجديد شهرين')."
        },
        "price": {
          "type": "number",
          "description": "The price of the renewal option in Yemeni Rial."
        }
      },
      "required": [
        "title",
        "price"
      ]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification sent to users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the notification."
        },
        "title": {
          "type": "string",
          "description": "The title of the notification."
        },
        "body": {
          "type": "string",
          "description": "The main content/message of the notification."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The date and time the notification was created."
        }
      },
      "required": [
        "title",
        "body",
        "timestamp"
      ]
    },
     "RenewalRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RenewalRequest",
      "type": "object",
      "description": "Represents a user's request to renew a service subscription.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the renewal request."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user making the request."
        },
        "userName": {
          "type": "string",
          "description": "The name of the user making the request."
        },
        "userPhoneNumber": {
          "type": "string",
          "description": "The phone number of the user making the request."
        },
        "packageTitle": {
          "type": "string",
          "description": "The title of the renewal package."
        },
        "packagePrice": {
          "type": "number",
          "description": "The price of the renewal package."
        },
        "subscriberName": {
          "type": "string",
          "description": "The name of the subscriber for whom the renewal is requested."
        },
        "cardNumber": {
          "type": "string",
          "description": "The card number for the renewal."
        },
        "status": {
          "type": "string",
          "enum": ["pending", "approved", "rejected"],
          "description": "The status of the renewal request."
        },
        "requestTimestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the request was made."
        }
      },
      "required": [
        "userId", "userName", "userPhoneNumber", "packageTitle", "packagePrice", 
        "subscriberName", "cardNumber", "status", "requestTimestamp"
      ]
    },
     "PaymentMethod": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PaymentMethod",
      "type": "object",
      "description": "Represents a payment method available in the app.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payment method."
        },
        "name": {
          "type": "string",
          "description": "The name of the payment service (e.g., 'بنك الكريمي')."
        },
        "accountHolderName": {
          "type": "string",
          "description": "The name of the account holder."
        },
        "accountNumber": {
          "type": "string",
          "description": "The account number for the payment method."
        },
        "logoUrl": {
          "type": "string",
          "description": "URL of the payment method's logo."
        }
      },
      "required": ["name", "accountNumber", "accountHolderName"]
    },
    "Advertisement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Advertisement",
      "type": "object",
      "description": "Represents the promotional banner content.",
      "properties": {
        "imageUrl": {
          "type": "string",
          "description": "The URL for the promotional image."
        },
        "linkUrl": {
          "type": "string",
          "description": "The URL to navigate to when the image is clicked."
        }
      },
      "required": ["imageUrl"]
    },
    "Subscriber": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscriber",
      "type": "object",
      "description": "Represents an Al-Wadi subscriber with a card number.",
      "properties": {
        "id": {
          "type": "string",
          "description": "The card number, used as the unique ID."
        },
        "name": {
          "type": "string",
          "description": "The full name of the subscriber."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "AppSettings": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Application Settings",
        "type": "object",
        "description": "Stores global settings for the application.",
        "properties": {
            "appLink": {
                "type": "string",
                "format": "uri",
                "description": "The official shareable link for the application."
            },
            "supportPhoneNumber": {
                "type": "string",
                "description": "The WhatsApp number for customer support."
            }
        },
        "required": ["appLink", "supportPhoneNumber"]
    },
     "TransferRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TransferRequest",
      "type": "object",
      "description": "Represents a user's request to transfer funds to another user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transfer request."
        },
        "fromUserId": {
          "type": "string",
          "description": "The ID of the user initiating the transfer."
        },
        "fromUserName": {
          "type": "string",
          "description": "The name of the user initiating the transfer."
        },
        "fromUserPhone": {
          "type": "string",
          "description": "The phone number of the user initiating the transfer."
        },
        "toUserId": {
          "type": "string",
          "description": "The ID of the user receiving the transfer."
        },
        "toUserName": {
          "type": "string",
          "description": "The name of the user receiving the transfer."
        },
        "toUserPhone": {
          "type": "string",
          "description": "The phone number of the user receiving the transfer."
        },
        "amount": {
          "type": "number",
          "description": "The amount to be transferred."
        },
        "status": {
          "type": "string",
          "enum": ["pending", "approved", "rejected"],
          "description": "The status of the transfer request."
        },
        "requestTimestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the request was made."
        }
      },
      "required": [
        "fromUserId", "fromUserName", "fromUserPhone", "toUserId", "toUserName", 
        "toUserPhone", "amount", "status", "requestTimestamp"
      ]
    },
    "Network": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Network",
        "type": "object",
        "description": "Represents a WiFi network available for users.",
        "properties": {
            "name": { "type": "string", "description": "The name of the WiFi network." },
            "location": { "type": "string", "description": "The physical location or coverage area of the network." },
            "phoneNumber": { "type": "string", "description": "A contact phone number for the network provider." }
        },
        "required": ["name", "location"]
    },
    "CardCategory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Card Category",
      "type": "object",
      "description": "Defines a category of WiFi cards for a specific network (e.g., 3 hours, 1 day).",
      "properties": {
        "networkId": {
          "type": "string",
          "description": "The ID of the parent network."
        },
        "name": {
          "type": "string",
          "description": "The name of the category (e.g., '3 Hours')."
        },
        "price": {
          "type": "number",
          "description": "The price for cards in this category."
        },
        "capacity": {
          "type": "string",
          "description": "The data capacity for this card category (e.g., '1 GB')."
        },
        "validity": {
          "type": "string",
          "description": "The validity period for this card category (e.g., '1 Day')."
        }
      },
      "required": [
        "networkId",
        "name",
        "price"
      ]
    },
    "NetworkCard": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Network Card",
        "type": "object",
        "description": "Represents an individual WiFi access card.",
        "properties": {
            "networkId": { "type": "string", "description": "The ID of the parent network." },
            "categoryId": { "type": "string", "description": "The ID of the card category this card belongs to." },
            "cardNumber": { "type": "string", "description": "The unique number or code for the card." },
            "status": {
                "type": "string",
                "enum": ["available", "sold", "expired"],
                "description": "The current status of the card."
            },
            "soldTo": { "type": "string", "description": "The ID of the user who purchased the card." },
            "soldTimestamp": { "type": "string", "format": "date-time", "description": "When the card was sold." }
        },
        "required": ["networkId", "categoryId", "cardNumber", "status"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the authenticated user can access their data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores transaction records for a specific user. Path-based ownership ensures only the authenticated user can access their transaction history.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier of the transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/favorites/{favoriteId}",
        "definition": {
          "entityName": "Favorite",
          "schema": {
            "$ref": "#/backend/entities/Favorite"
          },
          "description": "Stores user's favorite transactions or contacts. Path-based ownership ensures only the authenticated user can manage their favorites.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "favoriteId",
              "description": "The unique identifier of the favorite."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores personal notifications for a specific user. Writable by admins, readable by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "notificationId",
              "description": "The unique identifier for the notification."
            }
          ]
        }
      },
      {
        "path": "/alwadiOptions/{optionId}",
        "definition": {
          "entityName": "AlwadiRenewalOption",
          "schema": {
            "$ref": "#/backend/entities/AlwadiRenewalOption"
          },
          "description": "Stores the renewal options for the Al-Wadi service, manageable by an admin.",
          "params": [
            {
              "name": "optionId",
              "description": "The unique identifier of the Al-Wadi renewal option."
            }
          ]
        }
      },
      {
        "path": "/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores global notifications sent to all users. Read by everyone, write by admins.",
          "params": [
            {
              "name": "notificationId",
              "description": "The unique identifier for the notification."
            }
          ]
        }
      },
      {
        "path": "/renewalRequests/{requestId}",
        "definition": {
          "entityName": "RenewalRequest",
          "schema": {
            "$ref": "#/backend/entities/RenewalRequest"
          },
          "description": "Stores user subscription renewal requests. Users can create, admins can read and update status.",
          "params": [
            {
              "name": "requestId",
              "description": "The unique identifier for the renewal request."
            }
          ]
        }
      },
      {
        "path": "/paymentMethods/{methodId}",
        "definition": {
          "entityName": "PaymentMethod",
          "schema": {
            "$ref": "#/backend/entities/PaymentMethod"
          },
          "description": "Stores the available payment methods, manageable by an admin.",
          "params": [
            {
              "name": "methodId",
              "description": "The unique identifier for the payment method."
            }
          ]
        }
      },
      {
        "path": "/advertisements/{adId}",
        "definition": {
          "entityName": "Advertisement",
          "schema": {
            "$ref": "#/backend/entities/Advertisement"
          },
          "description": "Stores the promotional ad content. Writable by admins, readable by all.",
          "params": [
            {
              "name": "adId",
              "description": "The unique identifier for the advertisement."
            }
          ]
        }
      },
      {
        "path": "/subscribers/{subscriberId}",
        "definition": {
          "entityName": "Subscriber",
          "schema": {
            "$ref": "#/backend/entities/Subscriber"
          },
          "description": "Stores Al-Wadi subscribers, keyed by card number, for auto-filling names. Writable by admins, readable by all.",
          "params": [
            {
              "name": "subscriberId",
              "description": "The card number of the subscriber."
            }
          ]
        }
      },
      {
        "path": "/appSettings/{settingsId}",
        "definition": {
          "entityName": "AppSettings",
          "schema": {
            "$ref": "#/backend/entities/AppSettings"
          },
          "description": "Stores global application settings. Writable by admins, readable by all users.",
          "params": [
            {
              "name": "settingsId",
              "description": "The unique identifier for the settings document (e.g., 'global')."
            }
          ]
        }
      },
      {
        "path": "/transferRequests/{requestId}",
        "definition": {
          "entityName": "TransferRequest",
          "schema": {
            "$ref": "#/backend/entities/TransferRequest"
          },
          "description": "Stores user requests to transfer funds. Users can create, admins can read and update status.",
          "params": [
            {
              "name": "requestId",
              "description": "The unique identifier for the transfer request."
            }
          ]
        }
      },
      {
        "path": "/networks/{networkId}",
        "definition": {
          "entityName": "Network",
          "schema": {
            "$ref": "#/backend/entities/Network"
          },
          "description": "Stores WiFi network information. Readable by all users, writable by admins.",
          "params": [{ "name": "networkId", "description": "The unique ID for the network." }]
        }
      },
      {
        "path": "/networks/{networkId}/cardCategories/{categoryId}",
        "definition": {
          "entityName": "CardCategory",
          "schema": {
            "$ref": "#/backend/entities/CardCategory"
          },
          "description": "Stores categories of cards for a specific network. Readable by all, writable by admins.",
          "params": [
            { "name": "networkId", "description": "The parent network ID." },
            { "name": "categoryId", "description": "The unique ID for the card category." }
          ]
        }
      },
      {
        "path": "/networks/{networkId}/cards/{cardId}",
        "definition": {
          "entityName": "NetworkCard",
          "schema": {
            "$ref": "#/backend/entities/NetworkCard"
          },
          "description": "Stores individual WiFi cards. Readable by all, writable by admins, purchasable by users.",
          "params": [
            { "name": "networkId", "description": "The parent network ID." },
            { "name": "cardId", "description": "The unique ID for the card." }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, following the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. User data and related entities (Transactions and Favorites) are organized under user-specific paths to maintain clear ownership. A new subcollection for personal notifications (`/users/{userId}/notifications`) is added to store user-specific alerts, such as balance top-ups from admins. This keeps personal notifications private and separate from global ones. Authorization Independence is achieved by storing all data relevant to a user within their dedicated path (`/users/{userId}`). This structure avoids `get()` calls in security rules. Segregation is enforced by storing distinct types of data (users, transactions, favorites) in separate collections, simplifying security rules. The structure also avoids the use of custom claims and relies solely on `request.auth.uid` for authorization."
  }
}
